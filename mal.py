import pandas as pd
import numpy as np
from sklearn.ensemble import ExtraTreesClassifier
from sklearn.ensemble import RandomForestClassifier
from sklearn.feature_selection import SelectFromModel
from sklearn.model_selection import train_test_split

Dataset = pd.read_csv("Dataset.csv", sep="|")

normal = Dataset[0:41323].drop(["legitimate"], axis=1)
malware = Dataset[41323::].drop(["legitimate"], axis=1)

new_data = Dataset.drop(['Name', 'md5', 'legitimate'], axis = 1).values

labels = Dataset['legitimate'].values

extratrees = ExtraTreesClassifier().fit(new_data, labels)

select = SelectFromModel(extratrees, prefit=True)

new_data_2 = select.transform(new_data)

features = new_data_2.shape[1]

importances = extratrees.feature_importances_

indices = np.argsort(importances)

# display the important feaures
print("\nImportant features:\n")
for f in range(features):
    print("%d"%(f+1),Dataset.columns[2+indices[f]],importances[indices[f]])
    
normal_train, normal_test, malware_train, malware_test = train_test_split(new_data_2, labels, test_size=0.2)

classifier = RandomForestClassifier(n_estimators=50)

classifier.fit(normal_train, malware_train)

# display the score or accuracy of detection or classification
print("\n====================================================================\n")
print("The score of the classifier is: ", classifier.score(normal_test, malware_test)*100)













